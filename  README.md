# Agent-Hostmaster (Node) ‚Äî Distributed Monitoring Agent for Aeza (Hackathon Autumn 2025)

**Agent-Hostmaster Node** ‚Äî —ç—Ç–æ –∞–≥–µ–Ω—Ç (–Ω–æ–¥–∞) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ **DNS-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–æ—á–µ–∫ –º–∏—Ä–∞**.  
–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö **¬´–•–∞–∫–∞—Ç–æ–Ω –û—Å–µ–Ω—å 2025¬ª**, –∫–µ–π—Å –æ—Ç **Aeza**.

–ò–¥–µ—è —Å–∏—Å—Ç–µ–º—ã: –∑–∞–ø—É—Å–∫–∞–µ–º **–º–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –Ω–æ–¥** (VPS/—Å–µ—Ä–≤–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö/–ª–æ–∫–∞—Ü–∏—è—Ö), –∏ –∫–∞–∂–¥–∞—è –Ω–æ–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è –∏–∑ Kafka, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—è ¬´–∫–∞—Ä—Ç—É –∑–¥–æ—Ä–æ–≤—å—è¬ª —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ –º–∏—Ä—É.

---

## ‚ú® –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–æ–¥–∞

–ù–æ–¥–∞:
- –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Kafka-—Ç–æ–ø–∏–∫ —Å –∑–∞–¥–∞—á–∞–º–∏ (`agent-tasks`);
- –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (HTTP / Ping / TCP / Traceroute / DNS);
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —á–µ–∫–µ—Ä —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏;
- –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Kafka-—Ç–æ–ø–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`check-results`);
- –¥–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è: `location` –∏ `country`;
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ SIGINT/SIGTERM.

---

## üß© –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Checkers)

–ù–æ–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á (`domain.TaskType`):

- **HTTP** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL/—Ö–æ—Å—Ç–∞ (–º–µ—Ç–æ–¥, –∑–∞–≥–æ–ª–æ–≤–∫–∏, body), —Å—Ç–∞—Ç—É—Å-–∫–æ–¥, IP, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- **PING** ‚Äî ICMP ping, –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤, RTT min/avg/max, IP
- **TCP** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ `host:port`, connect time, IP
- **TRACEROUTE** ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π traceroute —á–µ—Ä–µ–∑ `ping` —Å TTL, —Å–ø–∏—Å–æ–∫ —Ö–æ–ø–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∞
- **DNS** ‚Äî lookup –∑–∞–ø–∏—Å–µ–π: `A`, `AAAA`, `MX`, `NS`, `TXT`

> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∞—Ä–∫–µ—Ç–æ–≤/–ø—Ä–æ–≤–µ—Ä–æ–∫ = –Ω–æ–≤—ã–π —á–µ–∫–µ—Ä, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Checker`.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–º–µ–Ω–∞ (Kafka)

### –¢–æ–ø–∏–∫–∏:
- **Tasks**: `agent-tasks` ‚Äî –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
- **Results**: `check-results` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. Backend/Orchestrator –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–¥–∞—á—É –≤ `agent-tasks`
2. –ù–æ–¥–∞ —á–∏—Ç–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ Kafka
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É
4. –ü—É–±–ª–∏–∫—É–µ—Ç `CheckResult` –≤ `check-results`

---

## üì¶ –§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### Task (–ø—Ä–∏–º–µ—Ä)
```json
{
  "id": "task-001",
  "type": "HTTP",
  "target": "https://example.com",
  "parameters": {
    "timeout": "10s",
    "method": "GET",
    "headers": {
      "User-Agent": "agent-hostmaster"
    }
  }
}
````

–ü–æ–ª—è:

* `id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏ (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
* `type` ‚Äî —Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏: `HTTP`, `PING`, `TCP`, `TRACEROUTE`, `DNS`
* `target` ‚Äî —Ü–µ–ª—å (URL/–¥–æ–º–µ–Ω/IP)
* `parameters` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–∫–µ—Ä–∞

---

### CheckResult (–ø—Ä–∏–º–µ—Ä)

```json
{
  "taskId": "task-001",
  "agentId": "agent-ru-1",
  "status": "SUCCESS",
  "error": "",
  "duration": 120,
  "timestamp": "2025-10-12T12:34:56Z",
  "payload": {
    "http": [
      {
        "location": "ru-msk",
        "country": "RU",
        "time": "0.120s",
        "status": 200,
        "ip": "93.184.216.34",
        "result": "OK"
      }
    ]
  }
}
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ENV)

–ù–æ–¥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è **—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (–±–µ–∑ –∫–æ–Ω—Ñ–∏–≥-–ø–∞–∫–µ—Ç–æ–≤):

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è            | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                    | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| --------------------- |---------------------------------| ---------------------------------------------- |
| `KAFKA_BROKERS`       | `<broker-ip>:<broker-port>` | —Å–ø–∏—Å–æ–∫ –±—Ä–æ–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é                  |
| `KAFKA_TASKS_TOPIC`   | `agent-tasks`                   | —Ç–æ–ø–∏–∫ –∑–∞–¥–∞—á                                    |
| `KAFKA_RESULTS_TOPIC` | `check-results`                 | —Ç–æ–ø–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤                              |
| `AGENT_ID`            | `agent-1`                       | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–æ–¥—ã                             |
| `AGENT_LOCATION`      | `agent-1`                       | –ª–æ–∫–∞—Ü–∏—è/—Ç–æ—á–∫–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `de-fra-1`) |
| `AGENT_COUNTRY`       | `unknown`                       | —Å—Ç—Ä–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `DE`)                         |

–ü—Ä–∏–º–µ—Ä:

```bash
export KAFKA_BROKERS="kafka1:9092,kafka2:9092"
export KAFKA_TASKS_TOPIC="agent-tasks"
export KAFKA_RESULTS_TOPIC="check-results"
export AGENT_ID="agent-de-1"
export AGENT_LOCATION="de-fra"
export AGENT_COUNTRY="DE"
```

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
go run ./cmd/agent
```

–∏–ª–∏ (–µ—Å–ª–∏ `main.go` –≤ –∫–æ—Ä–Ω–µ):

```bash
go run .
```

### –ß–µ—Ä–µ–∑ –±–∏–Ω–∞—Ä–Ω–∏–∫

```bash
go build -o agent-hostmaster .
./agent-hostmaster
```

---

## üê≥ Docker (–ø—Ä–∏–º–µ—Ä)

```dockerfile
FROM golang:1.22-alpine AS build
WORKDIR /app
COPY . .
RUN go build -o agent-hostmaster .

FROM alpine:3.20
WORKDIR /app
COPY --from=build /app/agent-hostmaster /app/agent-hostmaster
RUN apk add --no-cache ca-certificates iputils bind-tools
ENTRYPOINT ["/app/agent-hostmaster"]
```

> –í–∞–∂–Ω–æ: –¥–ª—è `ping`/traceroute-–ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∞.
> –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å capabilities, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
docker run --cap-add=NET_RAW --cap-add=NET_ADMIN ...
```

---

## üß† –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ–∫–µ—Ä–æ–≤ (–∫—Ä–∞—Ç–∫–æ)

### HTTP

`parameters`:

* `method` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `GET`)
* `headers` (map)
* `body` (string)
* `timeout` (duration)

`target`: URL –∏–ª–∏ —Ö–æ—Å—Ç (–µ—Å–ª–∏ –±–µ–∑ —Å—Ö–µ–º—ã ‚Äî –±—É–¥–µ—Ç `http://`)

---

### PING

`parameters`:

* `count` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4)
* `timeout` (duration)

---

### TCP

`parameters`:

* `port` (–µ—Å–ª–∏ `target` –±–µ–∑ –ø–æ—Ä—Ç–∞)
* `timeout` (duration)

`target`: `host`, `host:port` –∏–ª–∏ URL (`http/https` ‚Üí –ø–æ—Ä—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

### TRACEROUTE

`parameters`:

* `max_hops` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)
* `timeout` (—Ç–∞–π–º–∞—É—Ç –Ω–∞ —Ö–æ–ø)

---

### DNS

`parameters`:

* `record_type`: `A`, `AAAA`, `MX`, `NS`, `TXT`
* `timeout` (duration)

---

## üåç –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è ‚Äú–ø–æ –≤—Å–µ–º—É –º–∏—Ä—É‚Äù

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∑–∞–ø—É—Å–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤:

* `agent-ru-msk-1` (RU / Moscow)
* `agent-de-fra-1` (DE / Frankfurt)
* `agent-us-nyc-1` (US / New York)
* ...

–ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç —Ç–æ–ø–∏–∫ –∑–∞–¥–∞—á –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –¥–æ–±–∞–≤–ª—è—è **–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏**.
Backend –∑–∞—Ç–µ–º –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å—Ç—Ä–æ–∏—Ç –∫–∞—Ä—Ç–∏–Ω—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º.

---

## üßØ Graceful shutdown

–ù–æ–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ:

* `SIGINT` (Ctrl+C)
* `SIGTERM`

–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç consumer loop –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç Kafka reader/writer.

---

## üèÅ –ò—Ç–æ–≥

**Agent-Hostmaster Node** ‚Äî —ç—Ç–æ —Ä–∞–±–æ—á–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Aeza:

* –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ Kafka,
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
* –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ ‚Äú–ø–æ –≤—Å–µ–º—É –º–∏—Ä—É‚Äù.

---

### Hackathon

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö **¬´–•–∞–∫–∞—Ç–æ–Ω –û—Å–µ–Ω—å 2025¬ª**, –∫–µ–π—Å –æ—Ç **Aeza**.
```
